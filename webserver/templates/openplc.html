<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- W3 CSS -->
    <!-- <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='w3.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Sweet alert Js -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title> {% block title%} {{ title }} {% endblock %}</title>
</head>

<body>
{% block top %} {{ top }} {% endblock %}
<div class='top'>
    <img src='/static/openplc_logo.gif' alt='OpenPLC' style='width:101px;height:40px;padding:5px 0px 0px 10px;float:left'>
    <h3 style='font-family:'Roboto', sans-serif; font-size:18px; color:white; padding:13px 111px 0px 0px; margin: 0px 0px 0px 0px'><center>OpenPLC Webserver</center></h3>
    <h3 style='font-family:'Roboto', sans-serif; font-size:18px; color:white; padding:13px 111px 0px 0px; margin: 0px 0px 0px 0px'><center><span style='color: #02EE07'>status</span>{% block project_name %}{% endblock %}</center></h3>

    <!--
       if openplc_runtime.status() == "Running":
            top_div += "<h3 style='font-family:\"Roboto\", sans-serif; font-size:18px; color:white; padding:13px 111px 0px 0px; margin: 0px 0px 0px 0px'><center><span style='color: #02EE07'>Running: </span>" + openplc_runtime.project_name + "</center></h3>"
        elif openplc_runtime.status() == "Compiling":
            top_div += "<h3 style='font-family:\"Roboto\", sans-serif; font-size:18px; color:white; padding:13px 111px 0px 0px; margin: 0px 0px 0px 0px'><center><span style='color: Yellow'>Compiling: </span>" + openplc_runtime.project_name + "</center></h3>"
        else:
            top_div += "<h3 style='font-family:\"Roboto\", sans-serif; font-size:18px; color:white; padding:13px 111px 0px 0px; margin: 0px 0px 0px 0px'><center><span style='color: Red'>Stopped: </span>" + openplc_runtime.project_name + "</center></h3>"
   -->
    <div class='user'>
        <img src='/static/users-icon-64x64.png' alt='User' style='width:50px;height:45px;padding:5px 5px 0px 5px;float:right'>
    
        <h3 style='font-family:\"Roboto\", sans-serif; font-size:18px; color:white; padding:13px 0px 0px 0px; margin: 0px 0px 0px 0px'>{current_user.name}</h3>
   
    </div>
</div>
<hr>
{% with messages = get_flashed_messages()%}
{% if messages %}
<ul>
{% for message in messages %}
    <li> {{message}}</li>
{% endfor %}
</ul>
{% endif %}
{% endwith %}

<div class='main'>
    <div class='w3-sidebar w3-bar-block' style='width:250px; background-color:#3D3D3D'>
        <br>
        <br>
        <div class="w3-bar-item"><img src='/static/home-icon-64x64.png' alt='Dashboard' style='width:47px;height:32px;padding:0px 15px 0px 0px;float:left'><p style='font-family:"Roboto", sans-serif; font-size:20px; color:white;margin: 2px 0px 0px 0px'>DashBoard</p></div>
        <div class="w3-bar-item"><img src='/static/programs-icon-64x64.png' alt='Programs' style='width:47px;height:32px;padding:0px 15px 0px 0px;float:left'><p style='font-family:"Roboto", sans-serif; font-size:20px; color:white;margin: 2px 0px 0px 0px'>Programs</p></div>
        <div class="w3-bar-item"><img src='/static/modbus-icon-512x512.png' alt='Modbus' style='width:47px;height:32px;padding:0px 15px 0px 0px;float:left'><p style='font-family:"Roboto", sans-serif; font-size:20px; color:white;margin: 2px 0px 0px 0px'>Slave Devices</p></div>
        <div class="w3-bar-item"><img src='/static/monitoring-icon-64x64.png' alt='Monitoring' style='width:47px;height:32px;padding:0px 15px 0px 0px;float:left'><p style='font-family:"Roboto", sans-serif; font-size:20px; color:white;margin: 2px 0px 0px 0px'>Monitoring</p></div>
        <div class="w3-bar-item"><img src='/static/hardware-icon-980x974.png' alt='Hardware' style='width:47px;height:32px;padding:0px 15px 0px 0px;float:left'><p style='font-family:"Roboto", sans-serif; font-size:20px; color:white;margin: 2px 0px 0px 0px'>Hardware</p></div>
        <div class="w3-bar-item"><img src='/static/users-icon-64x64.png' alt='Users' style='width:47px;height:32px;padding:0px 15px 0px 0px;float:left'><p style='font-family:"Roboto", sans-serif; font-size:20px; color:white;margin: 2px 0px 0px 0px'>Users</p></div>
        <div class="w3-bar-item"><img src='/static/settings-icon-64x64.png' alt='Settings' style='width:47px;height:32px;padding:0px 15px 0px 0px;float:left'><p style='font-family:"Roboto", sans-serif; font-size:20px; color:white;margin: 2px 0px 0px 0px'>Settings</p></div>
        <div class="w3-bar-item"><img src='/static/logout-icon-64x64.png' alt='Logout' style='width:47px;height:32px;padding:0px 15px 0px 0px;float:left'><p style='font-family:"Roboto", sans-serif; font-size:20px; color:white;margin: 2px 0px 0px 0px'>Logout</p></div>
        <br>
        <br>
    </div>

    <div style="margin-left:320px; margin-right:70px">
    <div style="w3-container">
        <div style="w3-container" class='main' id="content">
{% block content %}
             <!-- Jinja directives: page contents will go between them -->
    <!-- global openplc_runtime
    status_str = ""
    if openplc_runtime.status() == "Running":
        status_str = "<center><h3 style='font-family:\"Roboto\", sans-serif; font-size:18px; color:white; padding:0px 0px 0px 0px;'>Status: <i>Running</i></span></center></h3>"
        status_str += "<a href='stop_plc' class='button' style='width: 210px; height: 53px; margin: 0px 20px 0px 20px;'><b>Stop PLC</b></a>"
    else:
        status_str = "<center><h3 style='font-family:\"Roboto\", sans-serif; font-size:18px; color:white; padding:0px 0px 0px 0px;'>Status: <i>Stopped</i></span></center></h3>"
        status_str += "<a href='start_plc' class='button' style='width: 210px; height: 53px; margin: 0px 20px 0px 20px;'><b>Start PLC</b></a>" -->
        <br><h2>Compiling program</h2>
        <textarea id='mytextarea' style='height:500px; resize:vertical'>
loading logs...
        </textarea>
        <br><br><center><a href='dashboard' id='dashboard_button' class='button' style='background-color: #EDEDED; pointer-events: none; width: 310px; height: 53px; margin: 0px 20px 0px 20px;'><b>Go to Dashboard</b></a></center>

{% endblock %}
<div style="w3-container" id="users">
    {% block users %}
       
    {% endblock %}
 </div>
        </div>
    </div>
    </div>
    <div style="w3-container" id="footer">
       {% block footer %}
          &copy; Copyright 2022 by <a href="http://domain.invalid/">openPLC</a>.
       {% endblock %}
    </div>
    
</div>
</body>
<script>
	(function (global)
	{
		if(typeof (global) === "undefined")
		{
			throw new Error("window is undefined");
		}

		var _hash = "!";
		var noBackPlease = function ()
		{
			global.location.href += "#";

			// making sure we have the fruit available for juice....
			// 50 milliseconds for just once do not cost much (^__^)
			global.setTimeout(function ()
			{
				global.location.href += "!";
			}, 50);
		};

		// Earlier we had setInerval here....
		global.onhashchange = function ()
		{
			if (global.location.hash !== _hash)
			{
				global.location.hash = _hash;
			}
		};

		global.onload = function ()
		{
			loadData();
			noBackPlease();

			// disables backspace on page except on input fields and textarea..
			document.body.onkeydown = function (e)
			{
				var elm = e.target.nodeName.toLowerCase();
				if (e.which === 8 && (elm !== 'input' && elm  !== 'textarea'))
				{
					e.preventDefault();
				}
				// stopping event bubbling up the DOM tree..
				e.stopPropagation();
			};
		};
	})(window);

	var req;

	function loadData()
	{
		url = 'compilation-logs'
		try
		{
			req = new XMLHttpRequest();
		} catch (e)
		{
			try
			{
				req = new ActiveXObject('Msxml2.XMLHTTP');
			} catch (e)
			{
				try
				{
					req = new ActiveXObject('Microsoft.XMLHTTP');
				} catch (oc)
				{
					alert('No AJAX Support');
					return;
				}
			}
		}

		req.onreadystatechange = processReqChange;
		req.open('GET', url, true);
		req.send(null);
	}

	function processReqChange()
	{
		//If req shows 'complete'
		if (req.readyState == 4)
		{
			compilation_logs = document.getElementById('mytextarea');
			dashboard_button = document.getElementById('dashboard_button');

			//If 'OK'
			if (req.status == 200)
			{
				//Update textarea text
				compilation_logs.value = req.responseText;
				if ((req.responseText.search("Compilation finished with errors!") != -1) || (req.responseText.search("Compilation finished successfully!") != -1))
				{
					dashboard_button.style.background='#E02222'
					dashboard_button.style.pointerEvents='auto'
				}

				//Start a new update timer
				timeoutID = setTimeout('loadData()', 1000);
			}
			else
			{
				compilation_logs.value = 'There was a problem retrieving the logs. Error: ' + req.statusText;
			}
		}
	}
</script>

</html>